{% extends 'base.html' %}
{% block content %}

<div class="cart-container">
    <div class="cart-items">
        <h3>Order Summary</h3>
        {% for item in items %}
        <div class="cart-game-container mt-4 ml-auto mr-auto">
            <img class="cart-img" src="{{item.game.cover_image.url}}">
            <div class="cart-game-info">
                <h4>{{item.game.title}}</h4>
                <p>${{item.game.price}}</p>
                <h5>Total</h5>
                <p>${{item.get_total}}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="cart-info">
        <h3>Payment</h3>
        <p>Items: {{item_count}}</p>
        <p>Total: ${{total}}</p>
        <a href="{% url 'games:cart' %}" class="btn btn-primary mt-2">Return to Cart</a>
        <a href="#" class="btn btn-success mt-2 payment-btn">Make Payment</a>
    </div>
</div>

<script type="text/javascript">
    const paymentBtn = document.querySelector('.payment-btn');
    const total = '{{total}}'

    paymentBtn.addEventListener('click', function(e) {
        submitPaymentData();
    })

    function submitPaymentData() {
        console.log('Payment clicked');

        const url = '/process_order/'
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({'total': total})
        })
        .then(response => {
            return response.json()
        })
        .then(data => {
            console.log('Success:', data);
            alert('Transaction completed');
            window.location.href = "{% url 'games:game_list' %}";
        })
    }
</script>

{% endblock %}